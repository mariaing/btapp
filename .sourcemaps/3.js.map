{"version":3,"sources":["../../src/pages/chat/chat.module.ts","../../src/pages/chat/chat.ts","../../src/pipes/relative-time/relative-time.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ChatPage } from './chat';\nimport {RelativeTimePipe} from \"../../pipes/relative-time/relative-time\";\n\n@NgModule({\n  declarations: [\n    ChatPage,\n      RelativeTimePipe\n  ],\n  imports: [\n    IonicPageModule.forChild(ChatPage),\n  ],\n})\nexport class ChatPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.module.ts","import {Component, ViewChild} from '@angular/core';\nimport {Content, IonicPage, NavController, NavParams, TextInput} from 'ionic-angular';\nimport {StorageProvider} from \"../../providers/storage/storage\";\nimport {Api} from \"../../providers/api/api\";\nimport {Headers, RequestOptions} from '@angular/http';\n\n/**\n * Generated class for the ChatPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\ndeclare var io: any;\n@IonicPage()\n@Component({\n  selector: 'page-chat',\n  templateUrl: 'chat.html',\n})\nexport class ChatPage {\n    @ViewChild(Content) content: Content;\n    @ViewChild('chat_input') messageInput: TextInput;\n    msgList: any;\n    // user: UserInfo;\n    // toUser: UserInfo;\n    editorMsg = '';\n  constructor(private api: Api, private credentials: StorageProvider,public navCtrl: NavController, public navParams: NavParams) {\n      this.msgList = [];\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad ChatPage');\n  }\n    ionViewDidEnter() {\n        //get message list\n        this.getMsg().subscribe((res) => {\n            console.log(res)\n            this.msgList = res.data;\n            this.scrollToBottom();\n        });\n        io.socket.off('NuevoMensaje', (response)=>{\n\n        })\n        io.socket.on('NuevoMensaje', (response)=>{\n            console.log('llego donde era')\n            this.pushNewMsg(response);\n        })\n    }\n    onFocus() {\n        // this.content.resize();\n        this.scrollToBottom();\n    }\n    /**\n     * @name getMsg\n     * @returns {Promise<ChatMessage[]>}\n     */\n    getMsg() {\n        let authHeader = new Headers();\n        let token = this.credentials.getToken();\n        if (token) {\n            authHeader.append('Authorization', 'Bearer ' + token);\n        }\n\n        let options = new RequestOptions({headers: authHeader});\n        return this.api.get('empleados/'+this.credentials.getCredentials().empleado.id+'/mensajes', options);\n    }\n\n    /**\n     * @name sendMsg\n     */\n    sendMsg() {\n        if (!this.editorMsg.trim()) return;\n\n\n        let newMsg = {\n            who: 'contact',\n            empleado: this.credentials.getCredentials().empleado.id,\n            empresa: this.credentials.getCredentials().empleado.empresa,\n            message: this.editorMsg,\n        };\n\n        this.editorMsg = '';\n\n        let authHeader = new Headers();\n        let token = this.credentials.getToken();\n        if (token) {\n            authHeader.append('Authorization', 'Bearer ' + token);\n        }\n\n        let options = new RequestOptions({headers: authHeader});\n        this.api.post('empleados/mensajes', newMsg,options).subscribe((res)=>{\n            this.pushNewMsg(res.json().data);\n        });\n    }\n\n    /**\n     * @name pushNewMsg\n     * @param msg\n     */\n    pushNewMsg(msg) {\n        this.msgList.push(msg);\n        this.scrollToBottom();\n    }\n\n    getMsgIndexById(id: string) {\n        return this.msgList.findIndex(e => e.messageId === id)\n    }\n\n    scrollToBottom() {\n        setTimeout(() => {\n            if (this.content.scrollToBottom) {\n                this.content.scrollToBottom();\n            }\n        }, 400)\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/chat/chat.ts","import { Pipe, PipeTransform } from '@angular/core';\nimport * as moment from 'moment';\n/**\n * Generated class for the RelativeTimePipe pipe.\n *\n * See https://angular.io/api/core/Pipe for more info on Angular Pipes.\n */\nmoment.locale('es');\n@Pipe({\n  name: 'relativeTime',\n})\nexport class RelativeTimePipe implements PipeTransform {\n  /**\n   * Takes a value and makes it lowercase.\n   */\n  transform(value: string, ...args) {\n      return moment(value).toNow();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pipes/relative-time/relative-time.ts"],"sourceRoot":""}